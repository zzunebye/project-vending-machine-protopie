# Vending Machine

이 문제는 자판기에서 사용자가 원하는 음료수를 얻기까지의 메커니즘을 구현해야한다. 자판기 내부에서의 동작과 더불어, 경우의 수와 예외 케이스를 최대한 표현해야한다. 아웃풋은 로그 출력으로 진행한다.

주어진 전제 조건은 다음과 같다:


1. 현금의 경우 100, 500, 1000, 5000, 그리고 10000원의 다른 화폐 종류를 입력할 수 있으며, 카드를 이용해 결제를 할 수도 있다.
2. 구매 가능한 음료수는 콜라, 물, 커피로 **정해져 있다**.  각각의 음료수는 다른 가격을 가지고 있다. 콜라는 1100원, 물은 600원, 그리고 커피는 700원이다.

## 요구사항 정리

- 주어진 요구사항에는 사용자가 결제 수단과 화폐 먼저 입력할지, 음료수를 먼저 선택할지가 명시되어 있지 않다. 일반적으로 현금만을 사용하는 자판기는 돈을 먼저 자판기에 입력하지만, 카드를 사용하기 때문에, 사용자가 원하는 음료수를 선택하면 해당 음료수 가격에 대한 카드 결제가 활성화되는 것으로 로직을 구현할 것이다.
- 사용자가 음료수를 얻기를 원할 때, 사용자는 원하는 상품을 선택한 후, 현금을 넣거나 카드를 이용해 결제를 한다. 이 과정에서 자판기는 결제가 되었음을 확인한 후, 사용자가 선택한 상품과 거스름돈을 내 보낸다. 즉 **상품을 고르고, 결제를 한 후, 상품과 거스름돈을 받는 것이 기본적인 User Journey(여정)이다**.
- 추가적으로, 물건을 반출하는 동시에 자판기는 재고를 갱신해야 한다.
- 카드 결제는 외부 Provider에 의존한다고 가정한다.

### 결제 수단

- 현금과 카드 결제는 동시에 활성화된다고 고려한다. 이를 고려해서, 자판기에서 두 결제 수단은 동시에 접근될 수 있지만, 먼저 결제 완료 조건을 충족하는 수단이 생길 경우 결제 과정을 완료한다고 정의한다. 
- 현금의 경우, 투입되는 즉시 입력된 금액이 결제 가격 이상인지를 검사한 후, 거스름돈을 계산하고 결제를 완료한다. 
- 카드의 경우, 결제 가격에 대한 비교가 필요없기 때문에 결제가 성공했는지 여부만 체크한다.

### Edge cases

- 사용자가 음료수를 얻기 위한 결제 과정을 진행하던 도중에 다른 음료수를 얻고자 하여 결제 대상을 변경하고자 하는 경우
	- 사용자가 취소를 누를 수 있는 선택지를 제공한다.
- 자판기 내부 거스름돈이 부족한 경우
	- 이 경우에는 사용자 경험을 위해 에러 메시지를 보여준 후 User Journey를 취소하는 것이 좋을 것이다.
- 음료수를 선택하지 않았는데, 현금을 입력하는 경우
	- 이때는 현금을 즉시 반환해야한다. 두 가지 경우의 수가 있다. 지폐를 입력하려는 경우와 동전을 입력하려는 경우. 전자의 경우는 아예 지폐 입력기가 작동하지 않도록 하여 예방할 수 있다. 후자(동전)의 경우, 입력된 동전이 즉시 반환된다.
- 사용자가 결제를 더 이상 진행했지만, Journey를 직접 취소하지 않은 경우
	- 일정 시간이 지나면 자동으로 timeout되어야한다.
	- 카드 결제 역시, 일정 시간이 지나면 세션이 timeout되어야한다.

### 전역 상태

자판기 상태

- 벤딩 머신은 상품에 대한 **재고를 상태로서 유지**해야한다. 이 상태는 예를 들어 콜라가 완판된 이후에는 선택될 수 없도록 만든다. 또한 현재 자판기 내에 남아있는 거스름돈을 각각의 종류 별로 유지해야한다.

유저 여정 상태

- 유저가 음료수를 얻는 여정은 **일련의 상태**를 가지며, 여정이 완료될 경우 리셋된다. 여기에는 사용자가 선택한 음료수, 사용자가 해당 시점까지 투입한 현금의 가치를 포함한다.

### 주요 로직


사용자가 음료수를 얻기를 원할 때, 사용자는 원하는 상품을 선택한 후, 현금을 넣거나 카드를 이용해 결제를 한다. 이 과정에서 자판기는 결제가 되었음을 확인한 후, 사용자가 선택한 상품을 내 보낸다. 즉 상품을 고르고, 결제를 한 후, 물건을 받는 것이 기본적인 User Journey(여정)이다. 물건을 반출한 후, 자판기는 재고를 갱신 해야 한다.

일단 상품을 선택한 후에 사용자는 결제를 할 수 있게된다. 이때 현금을 충분하지 않게 넣을 경우, 사용자는 여전히 카드 결제를 시도할 수 있으며, 카드 결제를 하게되면 이미 투입한 현금은 그대로 반환된다.

또한 카드 결제를 하지 않았거나, 현금을 충분히 넣지 않은 경우 사용자는 결제를 취소할 수 있다. 이 경우에도 투입한 현금은 그대로 반환된다.

## Diagram

<img width="5100" alt="diagram" src="https://github.com/user-attachments/assets/2d71ccb7-1812-48ec-ab7a-96a86cec3372">

